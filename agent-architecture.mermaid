graph TD
    Start([User Question]) --> RouteQuestion[ðŸ“‹ Route Question]
    RouteQuestion --> ExecuteTools[ðŸ”§ Execute Tools]
    ExecuteTools --> CheckAttachment{Has Attachment?}
    CheckAttachment -->|Yes| AttachmentType{Attachment Type?}
    CheckAttachment -->|No| CheckLabel{Label Type?}

    AttachmentType -->|Python Code| RunPy[ðŸ run_py]
    AttachmentType -->|Excel/CSV| AnalyzeExcel[ðŸ“Š analyze_excel_file]
    AttachmentType -->|Audio| TranscribeAudio[ðŸŽµ transcribe_via_whisper]
    AttachmentType -->|Image| VisionTask[ðŸ‘ï¸ vision_task]

    CheckLabel -->|math| Calculator[ðŸ§® calculator]
    CheckLabel -->|youtube| YouTubeTranscript[ðŸ“¹ youtube_transcript]
    CheckLabel -->|search| WebSearch[ðŸ” web_multi_search]
    CheckLabel -->|general| NoTool[ðŸ’­ No specific tool]

    RunPy --> SynthesizeResponse[ðŸ§  Synthesize Response]
    AnalyzeExcel --> SynthesizeResponse
    TranscribeAudio --> SynthesizeResponse
    VisionTask --> SynthesizeResponse
    Calculator --> SynthesizeResponse
    YouTubeTranscript --> SynthesizeResponse
    WebSearch --> SynthesizeResponse
    NoTool --> SynthesizeResponse

    SynthesizeResponse --> NeedsSynthesis{Needs Additional<br/>Synthesis?}
    NeedsSynthesis -->|No: code excel<br/>image math| DirectAnswer[âœ… Use tool output directly<br/>Already complete]
    NeedsSynthesis -->|Yes: youtube audio<br/>search general| UseSynthesisLLM[ðŸ¤– Additional LLM synthesis<br/>Combine with context]

    DirectAnswer --> FormatOutput[âœ¨ Format Output]
    UseSynthesisLLM --> FormatOutput
    FormatOutput --> End([Final Answer])
